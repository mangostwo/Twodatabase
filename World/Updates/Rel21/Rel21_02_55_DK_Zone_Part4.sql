-- ----------------------------------------
-- Added to prevent timeout's while loading
-- ----------------------------------------
SET GLOBAL net_read_timeout=30;
SET GLOBAL net_write_timeout=60;
SET GLOBAL net_buffer_length=1000000; 
SET GLOBAL max_allowed_packet=1000000000;
SET GLOBAL connect_timeout=10000000;

-- --------------------------------------------------------------------------------
-- This is an attempt to create a full transactional MaNGOS update (v1.3)
-- --------------------------------------------------------------------------------
DROP PROCEDURE IF EXISTS `update_mangos`; 

DELIMITER $$

CREATE DEFINER=`root`@`localhost` PROCEDURE `update_mangos`()
BEGIN
    DECLARE bRollback BOOL  DEFAULT FALSE ;
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION SET `bRollback` = TRUE;

    -- Current Values (TODO - must be a better way to do this)
    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cCurStructure := (SELECT structure FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cCurContent := (SELECT content FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);

    -- Expected Values
    SET @cOldVersion = '21'; 
    SET @cOldStructure = '02'; 
    SET @cOldContent = '54';

    -- New Values
    SET @cNewVersion = '21';
    SET @cNewStructure = '02';
    SET @cNewContent = '55';
                            -- DESCRIPTION IS 30 Characters MAX    
    SET @cNewDescription = 'DK_Zone_Part4';

                        -- COMMENT is 150 Characters MAX
    SET @cNewComment = 'DK_Zone_Part4';

    -- Evaluate all settings
    SET @cCurResult := (SELECT description FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cOldResult := (SELECT description FROM db_version WHERE `version`=@cOldVersion AND `structure`=@cOldStructure AND `content`=@cOldContent);
    SET @cNewResult := (SELECT description FROM db_version WHERE `version`=@cNewVersion AND `structure`=@cNewStructure AND `content`=@cNewContent);

    IF (@cCurResult = @cOldResult) THEN    -- Does the current version match the expected version
        -- APPLY UPDATE
        START TRANSACTION;

        -- UPDATE THE DB VERSION
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        INSERT INTO `db_version` VALUES (@cNewVersion, @cNewStructure, @cNewContent, @cNewDescription, @cNewComment);
        SET @cNewResult := (SELECT description FROM db_version WHERE `version`=@cNewVersion AND `structure`=@cNewStructure AND `content`=@cNewContent);

        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        -- -- PLACE UPDATE SQL BELOW -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
-- UDB [083] DK Zone Part4. Update
-- ---------------------------
-- DK Starting Zone - phase 1 - part4. - Initiates
-- ---------------------------

-- Duplicates removed
DELETE FROM creature WHERE guid IN (129516,129533,129553,129555,129522,129548,129532,129520,129530,129556,129545,129521,129531,129519);
DELETE FROM creature_addon WHERE guid IN (129516,129533,129553,129555,129522,129548,129532,129520,129530,129556,129545,129521,129531,129519);
DELETE FROM creature_movement WHERE id IN (129516,129533,129553,129555,129522,129548,129532,129520,129530,129556,129545,129521,129531,129519);
DELETE FROM game_event_creature WHERE guid IN (129516,129533,129553,129555,129522,129548,129532,129520,129530,129556,129545,129521,129531,129519);
DELETE FROM game_event_creature_data WHERE guid IN (129516,129533,129553,129555,129522,129548,129532,129520,129530,129556,129545,129521,129531,129519);
DELETE FROM creature_battleground WHERE guid IN (129516,129533,129553,129555,129522,129548,129532,129520,129530,129556,129545,129521,129531,129519);
DELETE FROM creature_linking WHERE guid IN (129516,129533,129553,129555,129522,129548,129532,129520,129530,129556,129545,129521,129531,129519) 
OR master_guid IN (129516,129533,129553,129555,129522,129548,129532,129520,129530,129556,129545,129521,129531,129519);

-- Death Knight Initiate 
UPDATE creature SET spawntimesecs = 30 WHERE id = 28406;
UPDATE creature_addon SET auras = NULL WHERE guid IN (129492,129493,129494,129495,129496,129497,129498,129499);
UPDATE creature_addon SET mount = 0 WHERE guid IN (129519,129521,129522,129533,129547,129548,129550,129553); -- mount is part of wps.
-- # chating pairs
UPDATE creature SET MovementType = 2, spawndist = 0  WHERE guid IN (129492,129493,129494,129495,129496,129497,129498,129499);
DELETE FROM creature_movement WHERE id IN (129492,129493,129494,129495,129496,129497,129498,129499);
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129492,1,2435.57,-5752.25,153.682,12000,2840604,0,0,0,0,0,0,0,0,6.03884,0,0),
(129493,1,2439.02,-5753.13,153.679,17000,2840604,0,0,0,0,0,0,0,0,2.79253,0,0),
(129494,1,2381.65,-5662.37,154.17,17000,2840604,0,0,0,0,0,0,0,0,1.44862,0,0),
(129495,1,2382,-5659.11,154.332,12000,2840604,0,0,0,0,0,0,0,0,4.59022,0,0),
(129496,1,2334.03,-5696.31,154.005,17000,2840604,0,0,0,0,0,0,0,0,5.32325,0,0),
(129497,1,2336.52,-5699.58,154.005,12000,2840604,0,0,0,0,0,0,0,0,2.26893,0,0),
(129498,1,2349.02,-5682.49,154.004,17000,2840604,0,0,0,0,0,0,0,0,2.18166,0,0),
(129499,1,2347.2,-5680.35,154.003,12000,2840604,0,0,0,0,0,0,0,0,5.37561,0,0);
-- #1
UPDATE creature SET position_x = 2409.489, position_y = -5729.18, position_z = 153.92, orientation = 3.8, spawndist = 0, MovementType = 2 WHERE guid = 129547;
DELETE FROM creature_movement WHERE id = 129547;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129547,1,2409.489,-5729.18,153.92,2000,2840601,0,0,0,0,0,0,0,0,3.8,0,0),
(129547,2,2398.24,-5738.1,153.923,0,0,0,0,0,0,0,0,0,0,3.51732,0,0),
(129547,3,2386.8,-5734.52,153.922,0,0,0,0,0,0,0,0,0,0,2.57013,0,0),
(129547,4,2372.86,-5722.17,153.922,0,0,0,0,0,0,0,0,0,0,2.26872,0,0),
(129547,5,2366.02,-5712.39,153.922,0,0,0,0,0,0,0,0,0,0,1.78963,0,0),
(129547,6,2365.51,-5706.24,153.922,0,0,0,0,0,0,0,0,0,0,0.855789,0,0),
(129547,7,2368.78,-5703.15,153.922,10000,2840608,0,0,0,0,0,0,0,0,0.690856,0,0),
(129547,8,2358.21,-5706.16,153.922,0,0,0,0,0,0,0,0,0,0,2.85855,0,0),
(129547,9,2341.04,-5689.82,153.922,0,0,0,0,0,0,0,0,0,0,2.3292,0,0),
(129547,10,2313.73,-5661.47,152.761,0,0,0,0,0,0,0,0,0,0,2.56639,0,0),
(129547,11,2296.29,-5652.93,147.341,0,0,0,0,0,0,0,0,0,0,2.88369,0,0),
(129547,12,2278.16,-5647.89,143.137,0,0,0,0,0,0,0,0,0,0,2.9638,0,0),
(129547,13,2255.96,-5645.48,136.996,0,0,0,0,0,0,0,0,0,0,3.24733,0,0),
(129547,14,2234.36,-5647.77,130.968,0,0,0,0,0,0,0,0,0,0,3.42954,0,0),
(129547,15,2209.59,-5657.5,122.594,0,0,0,0,0,0,0,0,0,0,3.76412,0,0),
(129547,16,2188.9,-5675.6,113.179,0,0,0,0,0,0,0,0,0,0,3.89371,0,0),
(129547,17,2163.24,-5699.88,104.99,1000,2840606,0,0,0,0,0,0,0,0,3.94476,0,0),
(129547,18,2149.23,-5715.65,101.528,1000,2840605,0,0,0,0,0,0,0,0,3.99581,0,0);
-- #2
UPDATE creature SET position_x = 2455.27, position_y = -5523.46, position_z = 376.892, orientation = 5.96, spawndist = 0, MovementType = 2 WHERE guid = 129544;
DELETE FROM creature_movement WHERE id = 129544;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129544,1,2455.27,-5523.46,376.892,1000,2840601,0,0,0,0,0,0,0,0,5.96,0,0),
(129544,2,2451.31,-5528.92,376.891,0,0,0,0,0,0,0,0,0,0,3.66393,0,0),
(129544,3,2424.47,-5542.18,376.905,0,0,0,0,0,0,0,0,0,0,3.84064,0,0),
(129544,4,2403.66,-5563.52,377.005,0,0,0,0,0,0,0,0,0,0,4.24905,0,0),
(129544,5,2398.1,-5601.44,376.89,0,0,0,0,0,0,0,0,0,0,4.6064,0,0),
(129544,6,2397.91,-5614.95,377.018,0,0,0,0,0,0,0,0,0,0,4.26946,0,0),
(129544,7,2386.16,-5630.91,377.169,0,0,0,0,0,0,0,0,0,0,4.1116,0,0),
(129544,8,2379.33,-5642.43,382.439,0,0,0,0,0,0,0,0,0,0,4.2137,0,0),
(129544,9,2349.92,-5690.11,382.241,6000,2840602,0,0,0,0,0,0,0,0,4.12338,0,0),
(129544,10,2317.382,-5691.645,397.657,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129544,11,2326.912,-5757.448,349.2681,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129544,12,2393.624,-5793.929,280.0182,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129544,13,2412.465,-5744.004,213.0183,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129544,14,2370.03,-5724.759,190.7128,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129544,15,2376.46,-5775.706,188.7405,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129544,16,2394.322,-5787.392,177.6294,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129544,17,2410.993,-5733.013,154.435,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129544,18,2410.993,-5733.013,154.435,5000,2840603,0,0,0,0,0,0,0,0,0,0,0),
(129544,19,2402.19,-5740.02,153.922,0,0,0,0,0,0,0,0,0,0,3.63958,0,0),
(129544,20,2390.62,-5740.36,153.922,0,0,0,0,0,0,0,0,0,0,2.32332,0,0),
(129544,21,2363.53,-5711.92,153.922,0,0,0,0,0,0,0,0,0,0,1.18687,0,0),
(129544,22,2369.16,-5703.01,153.922,8000,2840608,0,0,0,0,0,0,0,0,0.73003,0,0),
(129544,23,2364.91,-5710.41,153.922,0,0,0,0,0,0,0,0,0,0,5.01359,0,0),
(129544,24,2390.29,-5740.17,153.922,0,0,0,0,0,0,0,0,0,0,5.48168,0,0),
(129544,25,2413.33,-5765.72,151.84,0,0,0,0,0,0,0,0,0,0,5.38744,0,0),
(129544,26,2427.09,-5783.53,143.045,0,0,0,0,0,0,0,0,0,0,5.14161,0,0),
(129544,27,2432.63,-5793.86,136.441,0,0,0,0,0,0,0,0,0,0,4.95861,0,0),
(129544,28,2436.14,-5814.65,123.068,0,0,0,0,0,0,0,0,0,0,4.85651,0,0),
(129544,29,2436.72,-5839.05,113.55,0,0,0,0,0,0,0,0,0,0,4.51643,0,0),
(129544,30,2427.56,-5854.77,107.495,1000,2840606,0,0,0,0,0,0,0,0,3.93917,0,0),
(129544,31,2360.64,-5893.59,105.393,1000,2840605,0,0,0,0,0,0,0,0,3.76639,0,0);
-- #3
UPDATE creature SET position_x = 2416.227, position_y = -5557.54, position_z = 376.89, orientation = 1.72, MovementType = 2, spawndist = 0 WHERE guid = 129518;
DELETE FROM creature_movement WHERE id = 129518;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129518,1,2416.227,-5557.54,376.89,1000,2840601,0,0,0,0,0,0,0,0,1.72,0,0),
(129518,2,2411.56,-5553.34,376.887,0,0,0,0,0,0,0,0,0,0,4.06137,0,0),
(129518,3,2396.85,-5576.58,376.906,0,0,0,0,0,0,0,0,0,0,4.57353,0,0),
(129518,4,2397.55,-5612.24,377.017,0,0,0,0,0,0,0,0,0,0,4.15728,0,0),
(129518,5,2377.61,-5641.62,382.439,0,0,0,0,0,0,0,0,0,0,3.72139,0,0),
(129518,6,2350.25,-5690.08,382.24,3000,2840602,0,0,0,0,0,0,0,0,3.64364,0,0),
(129518,7,2317.382,-5691.645,397.657,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129518,8,2326.912,-5757.448,349.2681,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129518,9,2393.624,-5793.929,280.0182,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129518,10,2412.465,-5744.004,213.0183,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129518,11,2370.03,-5724.759,190.7128,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129518,12,2376.46,-5775.706,188.7405,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129518,13,2394.322,-5787.392,177.6294,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129518,14,2410.993,-5733.013,154.435,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129518,15,2410.993,-5733.013,154.435,3000,2840603,0,0,0,0,0,0,0,0,0,0,0),
(129518,16,2351.89,-5758.46,153.923,5000,2840607,0,0,0,0,0,0,0,0,3.00429,0,0),
(129518,17,2369.3,-5754.95,153.958,0,0,0,0,0,0,0,0,0,0,6.25179,0,0),
(129518,18,2399.45,-5760.04,153.803,0,0,0,0,0,0,0,0,0,0,5.99261,0,0),
(129518,19,2415.18,-5767.65,151.114,0,0,0,0,0,0,0,0,0,0,5.47347,0,0),
(129518,20,2427.29,-5779.51,144.843,0,0,0,0,0,0,0,0,0,0,5.18994,0,0),
(129518,21,2433.29,-5797.08,134.236,0,0,0,0,0,0,0,0,0,0,5.00694,0,0),
(129518,22,2438.33,-5826.66,118.493,0,0,0,0,0,0,0,0,0,0,4.87735,0,0),
(129518,23,2436.51,-5841.68,112.666,0,0,0,0,0,0,0,0,0,0,4.17364,0,0),
(129518,24,2421.56,-5855.26,106.534,1000,2840606,0,0,0,0,0,0,0,0,3.76916,0,0), 
(129518,25,2379.9,-5856.38,105.407,1000,2840605,0,0,0,0,0,0,0,0,3.09764,0,0);
-- #4
UPDATE creature SET position_x = 2523.21, position_y = -5628.21, position_z = 377.004, orientation = 1.93, MovementType = 2, spawndist = 0 WHERE guid = 129529;
DELETE FROM creature_movement WHERE id = 129529;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129529,1,2523.21,-5628.21,377.004,1000,2840601,0,0,0,0,0,0,0,0,1.93,0,0),
(129529,2,2517.63,-5625.44,377.01,0,0,0,0,0,0,0,0,0,0,3.57347,0,0),
(129529,3,2480.55,-5653.1,376.997,0,0,0,0,0,0,0,0,0,0,3.48315,0,0),
(129529,4,2454.17,-5656.89,376.903,0,0,0,0,0,0,0,0,0,0,3.08653,0,0),
(129529,5,2426.21,-5647.1,377.148,0,0,0,0,0,0,0,0,0,0,2.74566,0,0),
(129529,6,2397.13,-5648.46,377.169,0,0,0,0,0,0,0,0,0,0,3.41325,0,0),
(129529,7,2385.79,-5652.5,382.439,0,0,0,0,0,0,0,0,0,0,3.6638,0,0),
(129529,8,2370,-5666.09,382.256,0,0,0,0,0,0,0,0,0,0,3.98424,0,0),
(129529,9,2354.86,-5693.19,382.239,5000,2840602,0,0,0,0,0,0,0,0,4.18451,0,0),
(129529,10,2317.382,-5691.645,397.657,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129529,11,2326.912,-5757.448,349.2681,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129529,12,2393.624,-5793.929,280.0182,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129529,13,2412.465,-5744.004,213.0183,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129529,14,2370.03,-5724.759,190.7128,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129529,15,2376.46,-5775.706,188.7405,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129529,16,2394.322,-5787.392,177.6294,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129529,17,2410.993,-5733.013,154.435,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129529,18,2410.993,-5733.013,154.435,5000,2840603,0,0,0,0,0,0,0,0,0,0,0),
(129529,19,2393.83,-5740.92,153.922,0,0,0,0,0,0,0,0,0,0,2.86783,0,0),
(129529,20,2380.11,-5732.51,153.922,0,0,0,0,0,0,0,0,0,0,2.22624,0,0),
(129529,21,2361.82,-5712.56,153.922,0,0,0,0,0,0,0,0,0,0,1.4432,0,0),
(129529,22,2363.47,-5704.23,153.922,0,0,0,0,0,0,0,0,0,0,0.664594,0,0),
(129529,23,2368.24,-5701.66,153.922,10000,2840608,0,0,0,0,0,0,0,0,0.389705,0,0),
(129529,24,2351.06,-5698.6,153.922,0,0,0,0,0,0,0,0,0,0,2.73804,0,0),
(129529,25,2310.19,-5658.97,151.566,0,0,0,0,0,0,0,0,0,0,2.52991,0,0),
(129529,26,2276.49,-5646.12,142.798,0,0,0,0,0,0,0,0,0,0,3.15711,0,0),
(129529,27,2237.28,-5644.73,132.36,0,0,0,0,0,0,0,0,0,0,3.44299,0,0),
(129529,28,2207.46,-5656.88,122.1,0,0,0,0,0,0,0,0,0,0,3.71395,0,0),
(129529,29,2184.74,-5675.28,112.96,0,0,0,0,0,0,0,0,0,0,3.84747,0,0),
(129529,30,2155.17,-5710.15,102.564,1000,2840606,0,0,0,0,0,0,0,0,4.03597,0,0),
(129529,31,2124.03,-5722.98,100.333,1000,2840605,0,0,0,0,0,0,0,0,3.30162,0,0);
-- #5
UPDATE creature SET position_x = 2477.05, position_y = -5647.81, position_z = 377.006, orientation = 5.92, MovementType = 2, spawndist = 0 WHERE guid = 129517;
DELETE FROM creature_movement WHERE id = 129517;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129517,1,2477.05,-5647.81,377.006,1000,2840601,0,0,0,0,0,0,0,0,5.92,0,0),
(129517,2,2478.18,-5653.36,377.01,0,0,0,0,0,0,0,0,0,0,3.68083,0,0),
(129517,3,2465.83,-5657.38,376.892,0,0,0,0,0,0,0,0,0,0,3.28028,0,0),
(129517,4,2420.22,-5645.76,376.89,0,0,0,0,0,0,0,0,0,0,3.26536,0,0),
(129517,5,2397.62,-5648.51,377.168,0,0,0,0,0,0,0,0,0,0,3.48684,0,0),
(129517,6,2386.39,-5653.11,382.439,0,0,0,0,0,0,0,0,0,0,3.7311,0,0),
(129517,7,2369.21,-5667.63,382.253,0,0,0,0,0,0,0,0,0,0,4.09474,0,0),
(129517,8,2353.39,-5690.9,382.239,3000,2840602,0,0,0,0,0,0,0,0,3.8222,0,0),
(129517,9,2317.382,-5691.645,397.657,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129517,10,2326.912,-5757.448,349.2681,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129517,11,2393.624,-5793.929,280.0182,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129517,12,2412.465,-5744.004,213.0183,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129517,13,2370.03,-5724.759,190.7128,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129517,14,2376.46,-5775.706,188.7405,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129517,15,2394.322,-5787.392,177.6294,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129517,16,2410.993,-5733.013,154.435,0,0,0,0,0,0,0,0,0,0,0,0,0),
(129517,17,2410.993,-5733.013,154.435,3000,2840603,0,0,0,0,0,0,0,0,0,0,0),
(129517,18,2377.25,-5753.65,153.969,0,0,0,0,0,0,0,0,0,0,3.31797,0,0),
(129517,19,2357.61,-5753.15,153.923,0,0,0,0,0,0,0,0,0,0,3.68172,0,0),
(129517,20,2351.36,-5756.78,153.923,5000,2840607,0,0,0,0,0,0,0,0,3.6346,0,0),
(129517,21,2324.66,-5729.4,153.92,0,0,0,0,0,0,0,0,0,0,2.36617,0,0),
(129517,22,2308.68,-5710.34,153.92,0,0,0,0,0,0,0,0,0,0,2.1007,0,0),
(129517,23,2299.49,-5683.95,153.793,0,0,0,0,0,0,0,0,0,0,1.86901,0,0),
(129517,24,2291.7,-5665.8,149.238,0,0,0,0,0,0,0,0,0,0,2.22637,0,0),
(129517,25,2274.66,-5653.11,142.253,0,0,0,0,0,0,0,0,0,0,2.75808,0,0),
(129517,26,2249.38,-5649.94,134.367,0,0,0,0,0,0,0,0,0,0,3.15863,0,0),
(129517,27,2231.71,-5653.3,129.165,0,0,0,0,0,0,0,0,0,0,3.43352,0,0),
(129517,28,2210.59,-5663.28,121.25,0,0,0,0,0,0,0,0,0,0,3.65736,0,0),
(129517,29,2191.05,-5678.36,112.588,0,0,0,0,0,0,0,0,0,0,3.7304,0,0),
(129517,30,2165.07,-5699.03,105.325,1000,2840606,0,0,0,0,0,0,0,0,3.90476,0,0),
(129517,31,2135.4,-5728.12,100.266,1000,2840605,0,0,0,0,0,0,0,0,3.91262,0,0);
-- #6
UPDATE creature SET position_x = 2413.64, position_y = -5737.27, position_z = 153.923, orientation = 3.86902, MovementType = 2, spawndist = 0 WHERE guid = 129546;
DELETE FROM creature_movement WHERE id = 129546;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129546,1,2413.64,-5737.27,153.923,1000,2840601,0,0,0,0,0,0,0,0,3.86902,0,0),
(129546,2,2373.33,-5754.69,153.961,0,0,0,0,0,0,0,0,0,0,3.34356,0,0),
(129546,3,2349.31,-5761.49,153.922,5000,2840607,0,0,0,0,0,0,0,0,1.76884,0,0),
(129546,4,2367,-5771.87,151.392,0,0,0,0,0,0,0,0,0,0,6.06104,0,0),
(129546,5,2380.8,-5774.62,154.028,0,0,0,0,0,0,0,0,0,0,6.11209,0,0),
(129546,6,2416.41,-5776.45,148.509,0,0,0,0,0,0,0,0,0,0,6.01155,0,0),
(129546,7,2430.24,-5787.44,140.563,0,0,0,0,0,0,0,0,0,0,5.40444,0,0),
(129546,8,2437.59,-5808,127.202,0,0,0,0,0,0,0,0,0,0,4.96462,0,0),
(129546,9,2441.6,-5832.16,117.571,0,0,0,0,0,0,0,0,0,0,4.86645,0,0),
(129546,10,2430.39,-5856.4,107.743,1000,2840606,0,0,0,0,0,0,0,0,4.06142,0,0),
(129546,11,2442.87,-5912.91,102.116,1000,2840605,0,0,0,0,0,0,0,0,4.90965,0,0);
-- #7
UPDATE creature SET position_x = 2352.14, position_y = -5757.91, position_z = 153.923, MovementType = 2, spawndist = 0 WHERE guid = 129550;
DELETE FROM creature_movement WHERE id = 129550;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129550,1,2352.14,-5757.91,153.923,1000,2840601,0,0,0,0,0,0,0,0,3.23752,0,0),
(129550,8,2352.14,-5757.91,153.923,4000,2840607,0,0,0,0,0,0,0,0,3.23752,0,0),
(129550,9,2341.61,-5727.9,153.922,0,0,0,0,0,0,0,0,0,0,1.55677,0,0),
(129550,10,2342.13,-5697.18,153.922,0,0,0,0,0,0,0,0,0,0,1.84658,0,0),
(129550,11,2317.47,-5651.82,151.422,0,0,0,0,0,0,0,0,0,0,2.33588,0,0),
(129550,12,2297.54,-5644.36,147.052,0,0,0,0,0,0,0,0,0,0,2.94867,0,0),
(129550,13,2245.47,-5638.62,135.882,0,0,0,0,0,0,0,0,0,0,3.22356,0,0),
(129550,14,2205.02,-5658.24,121.031,0,0,0,0,0,0,0,0,0,0,3.8778,0,0),
(129550,15,2161.18,-5703.33,104.27,1000,2840606,0,0,0,0,0,0,0,0,4.13698,0,0),
(129550,16,2178.08,-5770.89,101.346,1000,2840605,0,0,0,0,0,0,0,0,5.00484,0,0);
-- #8
UPDATE creature SET position_x = 2368.652588, position_y = -5703.335449, position_z = 153.922272, orientation = 0.69, MovementType = 2, spawndist = 0 WHERE guid = 129558;
DELETE FROM creature_movement WHERE id = 129558;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(129558,1,2368.652588,-5703.335449,153.922272,1000,2840601,0,0,0,0,0,0,0,0,0.69,0,0),
(129558,2,2373.52,-5722.48,153.922,0,0,0,0,0,0,0,0,0,0,5.28585,0,0),
(129558,3,2411.22,-5764.47,152.347,0,0,0,0,0,0,0,0,0,0,5.47748,0,0),
(129558,4,2429.98,-5784.48,142.151,0,0,0,0,0,0,0,0,0,0,5.22694,0,0),
(129558,5,2435.23,-5800.88,131.736,0,0,0,0,0,0,0,0,0,0,4.99918,0,0),
(129558,6,2431.43,-5850.32,109.292,1000,2840606,0,0,0,0,0,0,0,0,4.36615,0,0),
(129558,7,2417.03,-5895.6,104.705,1000,2840605,0,0,0,0,0,0,0,0,4.31903,0,0);

-- Death Knight Initiate 
DELETE FROM dbscripts_on_creature_movement WHERE id  BETWEEN 2840601 AND 2840608;
INSERT INTO dbscripts_on_creature_movement (id, delay, command, datalong, datalong2, buddy_entry, search_radius, data_flags, dataint, dataint2, dataint3, dataint4, x, y, z, o, comments) VALUES
(2840601,0,25,1,0,0,0,0,0,0,0,0,0,0,0,0,'RUN ON'),
(2840601,1,21,1,0,0,0,0,0,0,0,0,0,0,0,0,'active'),
(2840602,1,24,26308,0,0,0,0x08,0,0,0,0,0,0,0,0,'mount'),
(2840603,3,24,0,0,0,0,0x08,0,0,0,0,0,0,0,0,'unmount'),
(2840604,4,1,1,0,0,0,0,273,6,274,0,0,0,0,0,'random emote'),
(2840605,0,21,0,0,0,0,0,0,0,0,0,0,0,0,0,'unactive'),
(2840605,1,18,0,0,0,0,0,0,0,0,0,0,0,0,0,'despawn'),
(2840606,0,31,28609,25,0,0,0,-1000,0,0,0,0,0,0,0,''),
(2840606,1,26,0,0,28609,25,1,0,0,0,0,0,0,0,0,''),
(2840607,3,1,66,0,0,0,0,0,0,0,0,0,0,0,0,''),
(2840608,3,1,66,0,0,0,0,0,0,0,0,0,0,0,0,''),
(2840608,5,31,28377,70,0,0,0,0,0,0,0,0,0,0,0,''), -- check if creature is alive
(2840608,6,0,0,0,28377,15,7,2000000409,0,0,0,0,0,0,0,'force buddy to: say text');

-- texts
DELETE FROM db_script_string WHERE entry = 2000000409;
INSERT INTO db_script_string (entry, content_default, content_loc1, content_loc2, content_loc3, content_loc4, content_loc5, content_loc6, content_loc7, content_loc8, sound, type, language, emote, comment) VALUES
(2000000409,'Suffer well, death knight...',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,0,0,0,25,NULL);
    

        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        -- -- PLACE UPDATE SQL ABOVE -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -

        -- If we get here ok, commit the changes
        IF bRollback = TRUE THEN
            ROLLBACK;
            SHOW ERRORS;
            SELECT '* UPDATE FAILED *' AS `===== Status =====`,@cCurResult AS `===== DB is on Version: =====`;



        ELSE
            COMMIT;
            SELECT '* UPDATE COMPLETE *' AS `===== Status =====`,@cNewResult AS `===== DB is now on Version =====`;
        END IF;
    ELSE    -- Current version is not the expected version
        IF (@cCurResult = @cNewResult) THEN    -- Does the current version match the new version
            SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cCurResult AS `===== DB is already on Version =====`;
        ELSE    -- Current version is not one related to this update
            IF(@cCurResult IS NULL) THEN    -- Something has gone wrong
                SELECT '* UPDATE FAILED *' AS `===== Status =====`,'Unable to locate DB Version Information' AS `============= Error Message =============`;
            ELSE
		IF(@cOldResult IS NULL) THEN    -- Something has gone wrong
		    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
		    SET @cCurStructure := (SELECT `STRUCTURE` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
		    SET @cCurContent := (SELECT `Content` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurOutput = CONCAT(@cCurVersion, '_', @cCurStructure, '_', @cCurContent, ' - ',@cCurResult);
                    SET @cOldResult = CONCAT('Rel',@cOldVersion, '_', @cOldStructure, '_', @cOldContent, ' - ','IS NOT APPLIED');
                    SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cOldResult AS `=== Expected ===`,@cCurOutput AS `===== Found Version =====`;
		ELSE
		    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
		    SET @cCurStructure := (SELECT `STRUCTURE` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
		    SET @cCurContent := (SELECT `Content` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurOutput = CONCAT(@cCurVersion, '_', @cCurStructure, '_', @cCurContent, ' - ',@cCurResult);
                    SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cOldResult AS `=== Expected ===`,@cCurOutput AS `===== Found Version =====`;
                END IF;
            END IF;
        END IF;
    END IF;
END $$

DELIMITER ;

-- Execute the procedure
CALL update_mangos();

-- Drop the procedure
DROP PROCEDURE IF EXISTS `update_mangos`;

