-- ----------------------------------------
-- Added to prevent timeout's while loading
-- ----------------------------------------
SET GLOBAL net_read_timeout=30;
SET GLOBAL net_write_timeout=60;
SET GLOBAL net_buffer_length=1000000; 
SET GLOBAL max_allowed_packet=1000000000;
SET GLOBAL connect_timeout=10000000;

-- --------------------------------------------------------------------------------
-- This is an attempt to create a full transactional MaNGOS update (v1.3)
-- --------------------------------------------------------------------------------
DROP PROCEDURE IF EXISTS `update_mangos`; 

DELIMITER $$

CREATE DEFINER=`root`@`localhost` PROCEDURE `update_mangos`()
BEGIN
    DECLARE bRollback BOOL  DEFAULT FALSE ;
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION SET `bRollback` = TRUE;

    -- Current Values (TODO - must be a better way to do this)
    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cCurStructure := (SELECT structure FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cCurContent := (SELECT content FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);

    -- Expected Values
    SET @cOldVersion = '21'; 
    SET @cOldStructure = '02'; 
    SET @cOldContent = '53';

    -- New Values
    SET @cNewVersion = '21';
    SET @cNewStructure = '02';
    SET @cNewContent = '54';
                            -- DESCRIPTION IS 30 Characters MAX    
    SET @cNewDescription = 'DK_Zone_Part3';

                        -- COMMENT is 150 Characters MAX
    SET @cNewComment = 'DK_Zone_Part3';

    -- Evaluate all settings
    SET @cCurResult := (SELECT description FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cOldResult := (SELECT description FROM db_version WHERE `version`=@cOldVersion AND `structure`=@cOldStructure AND `content`=@cOldContent);
    SET @cNewResult := (SELECT description FROM db_version WHERE `version`=@cNewVersion AND `structure`=@cNewStructure AND `content`=@cNewContent);

    IF (@cCurResult = @cOldResult) THEN    -- Does the current version match the expected version
        -- APPLY UPDATE
        START TRANSACTION;

        -- UPDATE THE DB VERSION
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        INSERT INTO `db_version` VALUES (@cNewVersion, @cNewStructure, @cNewContent, @cNewDescription, @cNewComment);
        SET @cNewResult := (SELECT description FROM db_version WHERE `version`=@cNewVersion AND `structure`=@cNewStructure AND `content`=@cNewContent);

        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        -- -- PLACE UPDATE SQL BELOW -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -

-- ---------------------------
-- DK Starting Zone - phase 1 - part3. - Scarlet Miners
-- ---------------------------
-- UDP [082] DK Zone Part3. update
-- Scarlet Miner - q. req. (should respawn almost instant after despawn)
UPDATE creature SET spawntimesecs = 10 WHERE id = 28822;
-- Scarlet Miner #1 
UPDATE creature SET position_x = 2216.001709, position_y = -6019.908203, position_z = 8.945984, orientation = 4.067243, MovementType = 2, spawndist = 0 WHERE guid = 128904;
DELETE FROM creature_movement WHERE id = 128904;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128904,1,2216.001709,-6019.908203,8.945984,2000,2882201,0,0,0,0,0,0,0,0,4.35549,0,0),(128904,2,2206.69,-6050.58,6.27707,0,0,0,0,0,0,0,0,0,0,4.35549,0,0),(128904,3,2191.11,-6087.17,2.79132,0,0,0,0,0,0,0,0,0,0,4.38298,0,0),
(128904,4,2179.79,-6133.88,1.93313,0,0,0,0,0,0,0,0,0,0,4.33271,0,0),(128904,5,2169.92,-6152.61,1.19506,0,0,0,0,0,0,0,0,0,0,3.57002,0,0),(128904,6,2134.24,-6167,0.419345,0,0,0,0,0,0,0,0,0,0,4.10802,0,0),
(128904,7,2122.31,-6186.06,14.0377,0,0,0,0,0,0,0,0,0,0,4.17085,0,0),(128904,8,2118.87,-6192.96,13.3049,2000,2882202,0,0,0,0,0,0,0,0,4.06482,0,0);
-- Scarlet Miner #2
UPDATE creature SET position_x = 2300.483643, position_y = -5910.774902, position_z = 86.692505, orientation = 4.1, MovementType = 2, spawndist = 0 WHERE guid = 128905;
DELETE FROM creature_movement WHERE id = 128905;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128905,1,2300.483643,-5910.774902,86.692505,2000,2882201,0,0,0,0,0,0,0,0,4.1,0,0),(128905,2,2293.55,-5917.05,82.6056,0,0,0,0,0,0,0,0,0,0,4.5,0,0),(128905,3,2291.99,-5937.86,68.6884,0,0,0,0,0,0,0,0,0,0,4.4,0,0),
(128905,4,2285.03,-5954.97,58.3396,0,0,0,0,0,0,0,0,0,0,4.11897,0,0),(128905,5,2271.14,-5968.92,48.9592,0,0,0,0,0,0,0,0,0,0,3.69171,0,0),(128905,6,2250.53,-5976.27,38.1416,0,0,0,0,0,0,0,0,0,0,3.80481,0,0),
(128905,7,2235.15,-5990.82,28.9556,0,0,0,0,0,0,0,0,0,0,4.26348,0,0),(128905,8,2230.64,-5998.63,23.2568,0,0,0,0,0,0,0,0,0,0,4.21792,0,0),(128905,9,2222.41,-6016.41,10.5581,0,0,0,0,0,0,0,0,0,0,4.24148,0,0),
(128905,10,2210.8,-6041.32,6.66781,0,0,0,0,0,0,0,0,0,0,4.29646,0,0),(128905,11,2197.73,-6067.8,5.00293,0,0,0,0,0,0,0,0,0,0,4.1708,0,0),(128905,12,2181.79,-6096.56,1.5113,0,0,0,0,0,0,0,0,0,0,4.23363,0,0),
(128905,13,2176.28,-6119.68,1.27137,0,0,0,0,0,0,0,0,0,0,4.6224,0,0),(128905,14,2178.41,-6143.14,1.49253,0,0,0,0,0,0,0,0,0,0,5.04965,0,0),(128905,15,2186.09,-6157.27,2.71064,0,0,0,0,0,0,0,0,0,0,5.61592,0,0),
(128905,16,2202.49,-6165.09,1.20293,0,0,0,0,0,0,0,0,0,0,6.13977,0,0),(128905,17,2232.58,-6165.21,0.876994,0,0,0,0,0,0,0,0,0,0,0.0332994,0,0),(128905,18,2258.76,-6162.07,1.12015,0,0,0,0,0,0,0,0,0,0,5.8476,0,0),
(128905,19,2268.92,-6167.7,1.24728,0,0,0,0,0,0,0,0,0,0,4.96325,0,0),(128905,20,2271.04,-6187.32,13.9861,0,0,0,0,0,0,0,0,0,0,4.81639,0,0),(128905,21,2271.88,-6195.34,13.2237,2000,2882202,0,0,0,0,0,0,0,0,4.81639,0,0);
-- Scarlet Miner & Mine car #3  
UPDATE creature SET position_x = 2416.258057, position_y = -5891.284668, position_z = 104.595085, orientation = 0.440682 WHERE guid = 128869;
UPDATE creature SET position_x = 2416.258057, position_y = -5891.284668, position_z = 104.595085, orientation = 0.440682, MovementType = 2, spawndist = 0 WHERE guid = 128894;
DELETE FROM creature_movement WHERE id = 128894;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128894,1,2416.258057,-5891.284668,104.595085,2000,2882201,0,0,0,0,0,0,0,0,0.44,0,0),(128894,2,2430.03,-5884.64,104.602,0,0,0,0,0,0,0,0,0,0,5.75,0,0),(128894,3,2434.08,-5888.33,104.883,0,0,0,0,0,0,0,0,0,0,4.99,0,0),
(128894,4,2437.97,-5899.35,103.585,0,0,0,0,0,0,0,0,0,0,4.9803,0,0),(128894,5,2442.79,-5912.86,102.113,0,0,0,0,0,0,0,0,0,0,4.87427,0,0),(128894,6,2440.3,-5926.62,97.3613,0,0,0,0,0,0,0,0,0,0,4.28602,0,0),
(128894,7,2427.87,-5938.68,95.1745,0,0,0,0,0,0,0,0,0,0,3.7276,0,0),(128894,8,2422.66,-5942.83,96.5461,0,0,0,0,0,0,0,0,0,0,4.17449,0,0),(128894,9,2419.94,-5957.54,97.6666,0,0,0,0,0,0,0,0,0,0,5.02036,0,0),
(128894,10,2428.03,-5967.78,95.4582,0,0,0,0,0,0,0,0,0,0,5.59683,0,0),(128894,11,2437.99,-5971.81,95.8846,0,0,0,0,0,0,0,0,0,0,6.05236,0,0),(128894,12,2447.36,-5970.5,94.5749,0,0,0,0,0,0,0,0,0,0,0.566349,0,0),
(128894,13,2453.66,-5955.88,95.6707,2000,2882202,0,0,0,0,0,0,0,0,1.38709,0,0);
-- Scarlet Miner & Mine car #4 
UPDATE creature SET position_x = 2410.756348, position_y = -5939.629395, position_z = 97.339973, orientation = 5.943231 WHERE guid = 128860;
UPDATE creature SET position_x = 2410.756348, position_y = -5939.629395, position_z = 97.339973, orientation = 5.943231, MovementType = 2, spawndist = 0 WHERE guid = 128885;
DELETE FROM creature_movement WHERE id = 128885;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128885,1,2410.756348,-5939.629395,97.339973,2000,2882201,0,0,0,0,0,0,0,0,5.94,0,0),(128885,2,2418.29,-5945.4,96.7502,0,0,0,0,0,0,0,0,0,0,5.04,0,0),(128885,3,2418.23,-5953.19,97.8662,0,0,0,0,0,0,0,0,0,0,5.15,0,0),
(128885,4,2423.57,-5963.65,96.3384,0,0,0,0,0,0,0,0,0,0,5.53484,0,0),(128885,5,2437.87,-5970.48,96.0122,0,0,0,0,0,0,0,0,0,0,6.24955,0,0),(128885,6,2474.32,-5975.1,96.276,0,0,0,0,0,0,0,0,0,0,5.99508,0,0),
(128885,7,2494.78,-5978.27,95.4998,0,0,0,0,0,0,0,0,0,0,5.71626,0,0),(128885,8,2502.53,-5986.94,95.9192,0,0,0,0,0,0,0,0,0,0,5.42567,0,0),(128885,9,2515.76,-5995.49,102.375,0,0,0,0,0,0,0,0,0,0,6.18436,0,0),
(128885,10,2523.18,-5991.62,103.452,0,0,0,0,0,0,0,0,0,0,0.858627,0,0),(128885,11,2528.24,-5981.97,103.248,0,0,0,0,0,0,0,0,0,0,1.94326,0,0),(128885,12,2521.05,-5969.02,105.047,0,0,0,0,0,0,0,0,0,0,1.68433,0,0),
(128885,13,2522.14,-5957.16,107.549,0,0,0,0,0,0,0,0,0,0,1.33718,0,0),(128885,14,2522.25,-5950.23,109.716,0,0,0,0,0,0,0,0,0,0,2.07624,0,0),(128885,15,2514.35,-5940.16,111.123,0,0,0,0,0,0,0,0,0,0,2.31107,0,0),
(128885,16,2504.78,-5932.21,115.134,0,0,0,0,0,0,0,0,0,0,3.00222,0,0),(128885,17,2487.73,-5936.38,116.357,0,0,0,0,0,0,0,0,0,0,3.65803,0,0),(128885,18,2473.76,-5938.02,115.203,0,0,0,0,0,0,0,0,0,0,2.57418,0,0),
(128885,19,2469.85,-5932.18,115.978,0,0,0,0,0,0,0,0,0,0,1.88931,0,0),(128885,20,2465.38,-5916.21,113.31,0,0,0,0,0,0,0,0,0,0,2.5514,0,0),(128885,21,2453.98,-5909.97,112.809,0,0,0,0,0,0,0,0,0,0,3.11693,0,0),
(128885,22,2437,-5915.94,112.788,0,0,0,0,0,0,0,0,0,0,3.14599,0,0),(128885,23,2428.36,-5912.56,112.956,0,0,0,0,0,0,0,0,0,0,3.47665,0,0),(128885,24,2419.72,-5916.33,111.72,0,0,0,0,0,0,0,0,0,0,3.57089,0,0),
(128885,25,2407.87,-5920.25,110.704,0,0,0,0,0,0,0,0,0,0,3.09023,0,0),(128885,26,2382.72,-5912.66,109.618,0,0,0,0,0,0,0,0,0,0,2.8012,0,0),(128885,27,2360.63,-5906.09,105.863,0,0,0,0,0,0,0,0,0,0,2.87974,0,0),
(128885,28,2339.74,-5900.61,102.166,0,0,0,0,0,0,0,0,0,0,3.0164,0,0),(128885,29,2320.65,-5901.12,96.3481,0,0,0,0,0,0,0,0,0,0,3.36748,0,0),(128885,30,2302.29,-5906.91,88.4851,0,0,0,0,0,0,0,0,0,0,3.71462,0,0),
(128885,31,2298.87,-5912.52,85.7672,0,0,0,0,0,0,0,0,0,0,4.15602,0,0),(128885,32,2294.47,-5920.02,80.6317,0,0,0,0,0,0,0,0,0,0,4.48588,0,0),(128885,33,2295.5,-5927.8,75.0694,0,0,0,0,0,0,0,0,0,0,4.50787,0,0),
(128885,34,2289.38,-5936.56,68.8048,0,0,0,0,0,0,0,0,0,0,4.35394,0,0),(128885,35,2281.71,-5954.08,57.7201,0,0,0,0,0,0,0,0,0,0,4.07015,0,0),(128885,36,2273.67,-5964.09,51.0012,0,0,0,0,0,0,0,0,0,0,3.82197,0,0),
(128885,37,2263.62,-5972.28,44.9642,0,0,0,0,0,0,0,0,0,0,3.50074,0,0),(128885,38,2250.32,-5978.05,37.1378,0,0,0,0,0,0,0,0,0,0,3.68923,0,0),(128885,39,2242.16,-5986.44,32.0029,0,0,0,0,0,0,0,0,0,0,3.9759,0,0),
(128885,40,2236.48,-5994.7,27.2984,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),(128885,41,2232.02,-6001.88,21.9415,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),(128885,42,2222.59,-6018.69,9.85442,0,0,0,0,0,0,0,0,0,0,4.25079,0,0),
(128885,43,2210.65,-6043.1,6.58405,0,0,0,0,0,0,0,0,0,0,4.27435,0,0),(128885,44,2195.04,-6068.81,4.8415,0,0,0,0,0,0,0,0,0,0,4.29006,0,0),(128885,45,2184.79,-6100.61,0.801771,0,0,0,0,0,0,0,0,0,0,4.45499,0,0),
(128885,46,2180.3,-6117.91,1.28701,0,0,0,0,0,0,0,0,0,0,4.35368,0,0),(128885,47,2176.49,-6139.76,1.21043,0,0,0,0,0,0,0,0,0,0,4.53432,0,0),(128885,48,2168.43,-6148.86,1.24682,0,0,0,0,0,0,0,0,0,0,3.76777,0,0),
(128885,49,2151.16,-6153.96,1.24645,0,0,0,0,0,0,0,0,0,0,3.43005,0,0),(128885,50,2134,-6167.23,0.364198,0,0,0,0,0,0,0,0,0,0,4.12905,0,0),(128885,51,2122.69,-6185.79,14.1288,0,0,0,0,0,0,0,0,0,0,4.1801,0,0),
(128885,52,2119.26,-6191.63,13.2701,2000,2882202,0,0,0,0,0,0,0,0,4.1801,0,0);
-- Scarlet Miner & Mine car #5 
UPDATE creature SET position_x = 2477.604004, position_y = -5931.103027, position_z = 115.977074, orientation = 3.842377, MovementType = 2, spawndist = 0 WHERE guid = 128893;
DELETE FROM creature_movement WHERE id = 128893;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128893,1,2477.604004,-5931.103027,115.977074,2000,2882201,0,0,0,0,0,0,0,0,3.84,0,0),(128893,2,2469.85,-5932.18,115.978,0,0,0,0,0,0,0,0,0,0,1.9,0,0),(128893,3,2465.38,-5916.21,113.31,0,0,0,0,0,0,0,0,0,0,2.6,0,0),
(128893,4,2453.98,-5909.97,112.809,0,0,0,0,0,0,0,0,0,0,3.11693,0,0),(128893,5,2437,-5915.94,112.788,0,0,0,0,0,0,0,0,0,0,3.14599,0,0),(128893,6,2428.36,-5912.56,112.956,0,0,0,0,0,0,0,0,0,0,3.47665,0,0),
(128893,7,2419.72,-5916.33,111.72,0,0,0,0,0,0,0,0,0,0,3.57089,0,0),(128893,8,2407.87,-5920.25,110.704,0,0,0,0,0,0,0,0,0,0,3.09023,0,0),(128893,9,2382.72,-5912.66,109.618,0,0,0,0,0,0,0,0,0,0,2.8012,0,0),
(128893,10,2360.63,-5906.09,105.863,0,0,0,0,0,0,0,0,0,0,2.87974,0,0),(128893,11,2339.74,-5900.61,102.166,0,0,0,0,0,0,0,0,0,0,3.0164,0,0),(128893,12,2320.65,-5901.12,96.3481,0,0,0,0,0,0,0,0,0,0,3.36748,0,0),
(128893,13,2302.29,-5906.91,88.4851,0,0,0,0,0,0,0,0,0,0,3.71462,0,0),(128893,14,2298.87,-5912.52,85.7672,0,0,0,0,0,0,0,0,0,0,4.15602,0,0),(128893,15,2294.47,-5920.02,80.6317,0,0,0,0,0,0,0,0,0,0,4.48588,0,0),
(128893,16,2295.5,-5927.8,75.0694,0,0,0,0,0,0,0,0,0,0,4.50787,0,0),(128893,17,2289.38,-5936.56,68.8048,0,0,0,0,0,0,0,0,0,0,4.35394,0,0),(128893,18,2281.71,-5954.08,57.7201,0,0,0,0,0,0,0,0,0,0,4.07015,0,0),
(128893,19,2273.67,-5964.09,51.0012,0,0,0,0,0,0,0,0,0,0,3.82197,0,0),(128893,20,2263.62,-5972.28,44.9642,0,0,0,0,0,0,0,0,0,0,3.50074,0,0),(128893,21,2250.32,-5978.05,37.1378,0,0,0,0,0,0,0,0,0,0,3.68923,0,0),
(128893,22,2242.16,-5986.44,32.0029,0,0,0,0,0,0,0,0,0,0,3.9759,0,0),(128893,23,2236.48,-5994.7,27.2984,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),(128893,24,2232.02,-6001.88,21.9415,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),
(128893,25,2222.59,-6018.69,9.85442,0,0,0,0,0,0,0,0,0,0,4.25079,0,0),(128893,26,2210.65,-6043.1,6.58405,0,0,0,0,0,0,0,0,0,0,4.27435,0,0),(128893,27,2195.04,-6068.81,4.8415,0,0,0,0,0,0,0,0,0,0,4.29006,0,0),
(128893,28,2184.79,-6100.61,0.801771,0,0,0,0,0,0,0,0,0,0,4.45499,0,0),(128893,29,2180.3,-6117.91,1.28701,0,0,0,0,0,0,0,0,0,0,4.35368,0,0),(128893,30,2176.49,-6139.76,1.21043,0,0,0,0,0,0,0,0,0,0,4.53432,0,0),
(128893,31,2168.43,-6148.86,1.24682,0,0,0,0,0,0,0,0,0,0,3.76777,0,0),(128893,32,2151.16,-6153.96,1.24645,0,0,0,0,0,0,0,0,0,0,3.43005,0,0),(128893,33,2134,-6167.23,0.364198,0,0,0,0,0,0,0,0,0,0,4.12905,0,0),
(128893,34,2122.69,-6185.79,14.1288,0,0,0,0,0,0,0,0,0,0,4.1801,0,0),(128893,35,2119.26,-6191.63,13.2701,2000,2882202,0,0,0,0,0,0,0,0,4.1801,0,0);
-- Scarlet Miner & Mine car #6 
UPDATE creature SET position_x = 2406.754639, position_y = -5931.366211, position_z = 112.795784, orientation = 1.730102 WHERE guid = 128873;
UPDATE creature SET position_x = 2406.754639, position_y = -5931.366211, position_z = 112.795784, orientation = 1.730102, MovementType = 2, spawndist = 0 WHERE guid = 128898;
DELETE FROM creature_movement WHERE id = 128898;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128898,1,2406.754639,-5931.366211,112.795784,2000,2882201,0,0,0,0,0,0,0,0,1.73,0,0),(128898,2,2408.93,-5923.46,111.244,0,0,0,0,0,0,0,0,0,0,0.75,0,0),(128898,3,2420.15,-5915.89,111.804,0,0,0,0,0,0,0,0,0,0,0.6,0,0),
(128898,4,2424.12,-5913.94,112.944,0,0,0,0,0,0,0,0,0,0,0.322753,0,0),(128898,5,2429.91,-5913.57,112.917,0,0,0,0,0,0,0,0,0,0,6.02989,0,0),(128898,6,2436.71,-5915.68,112.756,0,0,0,0,0,0,0,0,0,0,0.164542,0,0),
(128898,7,2454.24,-5910.7,112.815,0,0,0,0,0,0,0,0,0,0,6.00319,0,0),(128898,8,2461.68,-5912.38,112.696,0,0,0,0,0,0,0,0,0,0,5.52956,0,0),(128898,9,2466.62,-5920.92,113.937,0,0,0,0,0,0,0,0,0,0,5.10781,0,0),
(128898,10,2470.2,-5931.9,115.936,0,0,0,0,0,0,0,0,0,0,4.94288,0,0),(128898,11,2471.25,-5946.04,114.238,0,0,0,0,0,0,0,0,0,0,3.91009,0,0),(128898,12,2461.91,-5945.94,115.98,0,0,0,0,0,0,0,0,0,0,2.90478,0,0),
(128898,13,2442.28,-5941.64,118.664,2000,2882202,0,0,0,0,0,0,0,0,3.00295,0,0);
-- Scarlet Miner & Mine car #7
UPDATE creature SET position_x = 2419.589111, position_y = -5899.963867, position_z = 113.110573, orientation = 5.496583 WHERE guid = 128874;
UPDATE creature SET position_x = 2419.589111, position_y = -5899.963867, position_z = 113.110573, orientation = 5.496583, MovementType = 2, spawndist = 0 WHERE guid = 128899;
DELETE FROM creature_movement WHERE id = 128899;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128899,1,2419.589111,-5899.963867,113.110573,2000,2882201,0,0,0,0,0,0,0,0,5.49658,0,0),(128899,2,2424.73,-5905.68,113.469,0,0,0,0,0,0,0,0,0,0,4.6017,0,0),(128899,3,2423.05,-5913.57,112.85,0,0,0,0,0,0,0,0,0,0,3.9,0,0),
(128899,4,2419.72,-5916.33,111.72,0,0,0,0,0,0,0,0,0,0,3.57089,0,0),(128899,5,2407.87,-5920.25,110.704,0,0,0,0,0,0,0,0,0,0,3.09023,0,0),(128899,6,2382.72,-5912.66,109.618,0,0,0,0,0,0,0,0,0,0,2.8012,0,0),
(128899,7,2360.63,-5906.09,105.863,0,0,0,0,0,0,0,0,0,0,2.87974,0,0),(128899,8,2339.74,-5900.61,102.166,0,0,0,0,0,0,0,0,0,0,3.0164,0,0),(128899,9,2320.65,-5901.12,96.3481,0,0,0,0,0,0,0,0,0,0,3.36748,0,0),
(128899,10,2302.29,-5906.91,88.4851,0,0,0,0,0,0,0,0,0,0,3.71462,0,0),(128899,11,2298.87,-5912.52,85.7672,0,0,0,0,0,0,0,0,0,0,4.15602,0,0),(128899,12,2294.47,-5920.02,80.6317,0,0,0,0,0,0,0,0,0,0,4.48588,0,0),
(128899,13,2295.5,-5927.8,75.0694,0,0,0,0,0,0,0,0,0,0,4.50787,0,0),(128899,14,2289.38,-5936.56,68.8048,0,0,0,0,0,0,0,0,0,0,4.35394,0,0),(128899,15,2281.71,-5954.08,57.7201,0,0,0,0,0,0,0,0,0,0,4.07015,0,0),
(128899,16,2273.67,-5964.09,51.0012,0,0,0,0,0,0,0,0,0,0,3.82197,0,0),(128899,17,2263.62,-5972.28,44.9642,0,0,0,0,0,0,0,0,0,0,3.50074,0,0),(128899,18,2250.32,-5978.05,37.1378,0,0,0,0,0,0,0,0,0,0,3.68923,0,0),
(128899,19,2242.16,-5986.44,32.0029,0,0,0,0,0,0,0,0,0,0,3.9759,0,0),(128899,20,2236.48,-5994.7,27.2984,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),(128899,21,2232.02,-6001.88,21.9415,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),
(128899,22,2222.59,-6018.69,9.85442,0,0,0,0,0,0,0,0,0,0,4.25079,0,0),(128899,23,2210.65,-6043.1,6.58405,0,0,0,0,0,0,0,0,0,0,4.27435,0,0),(128899,24,2195.04,-6068.81,4.8415,0,0,0,0,0,0,0,0,0,0,4.29006,0,0),
(128899,25,2184.79,-6100.61,0.801771,0,0,0,0,0,0,0,0,0,0,4.45499,0,0),(128899,26,2180.3,-6117.91,1.28701,0,0,0,0,0,0,0,0,0,0,4.35368,0,0),(128899,27,2176.49,-6139.76,1.21043,0,0,0,0,0,0,0,0,0,0,4.53432,0,0),
(128899,28,2168.43,-6148.86,1.24682,0,0,0,0,0,0,0,0,0,0,3.76777,0,0),(128899,29,2151.16,-6153.96,1.24645,0,0,0,0,0,0,0,0,0,0,3.43005,0,0),(128899,30,2134,-6167.23,0.364198,0,0,0,0,0,0,0,0,0,0,4.12905,0,0),
(128899,31,2122.69,-6185.79,14.1288,0,0,0,0,0,0,0,0,0,0,4.1801,0,0),(128899,32,2119.26,-6191.63,13.2701,2000,2882202,0,0,0,0,0,0,0,0,4.1801,0,0);
-- Scarlet Miner & Mine car #8
UPDATE creature SET position_x = 2535.325195, position_y = -5944.641602, position_z = 109.437996, orientation = 3.43 WHERE guid = 128864;
UPDATE creature SET position_x = 2535.325195, position_y = -5944.641602, position_z = 109.437996, orientation = 3.43, MovementType = 2, spawndist = 0 WHERE guid = 128889;
DELETE FROM creature_movement WHERE id = 128889;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128889,1,2535.325195,-5944.641602,109.438,2000,2882201,0,0,0,0,0,0,0,0,3.43,0,0),(128889,2,2524.54,-5946.4,109.71,0,0,0,0,0,0,0,0,0,0,2.77,0,0),(128889,3,2514.45,-5939.26,111.185,0,0,0,0,0,0,0,0,0,0,2.47,0,0),
(128889,4,2505.28,-5932.11,115.146,0,0,0,0,0,0,0,0,0,0,3.02253,0,0),(128889,5,2487.64,-5937.46,116.247,0,0,0,0,0,0,0,0,0,0,3.55975,0,0),(128889,6,2476.57,-5939.55,114.837,0,0,0,0,0,0,0,0,0,0,2.58585,0,0),
(128889,7,2470.52,-5935.27,115.852,0,0,0,0,0,0,0,0,0,0,1.92881,0,0),(128889,8,2469.85,-5932.18,115.978,0,0,0,0,0,0,0,0,0,0,1.88931,0,0),(128889,9,2465.38,-5916.21,113.31,0,0,0,0,0,0,0,0,0,0,2.5514,0,0),
(128889,10,2453.98,-5909.97,112.809,0,0,0,0,0,0,0,0,0,0,3.11693,0,0),(128889,11,2437,-5915.94,112.788,0,0,0,0,0,0,0,0,0,0,3.14599,0,0),(128889,12,2428.36,-5912.56,112.956,0,0,0,0,0,0,0,0,0,0,3.47665,0,0),
(128889,13,2419.72,-5916.33,111.72,0,0,0,0,0,0,0,0,0,0,3.57089,0,0),(128889,14,2407.87,-5920.25,110.704,0,0,0,0,0,0,0,0,0,0,3.09023,0,0),(128889,15,2382.72,-5912.66,109.618,0,0,0,0,0,0,0,0,0,0,2.8012,0,0),
(128889,16,2360.63,-5906.09,105.863,0,0,0,0,0,0,0,0,0,0,2.87974,0,0),(128889,17,2339.74,-5900.61,102.166,0,0,0,0,0,0,0,0,0,0,3.0164,0,0),(128889,18,2320.65,-5901.12,96.3481,0,0,0,0,0,0,0,0,0,0,3.36748,0,0),
(128889,19,2302.29,-5906.91,88.4851,0,0,0,0,0,0,0,0,0,0,3.71462,0,0),(128889,20,2298.87,-5912.52,85.7672,0,0,0,0,0,0,0,0,0,0,4.15602,0,0),(128889,21,2294.47,-5920.02,80.6317,0,0,0,0,0,0,0,0,0,0,4.48588,0,0),
(128889,22,2295.5,-5927.8,75.0694,0,0,0,0,0,0,0,0,0,0,4.50787,0,0),(128889,23,2289.38,-5936.56,68.8048,0,0,0,0,0,0,0,0,0,0,4.35394,0,0),(128889,24,2281.71,-5954.08,57.7201,0,0,0,0,0,0,0,0,0,0,4.07015,0,0),
(128889,25,2273.67,-5964.09,51.0012,0,0,0,0,0,0,0,0,0,0,3.82197,0,0),(128889,26,2263.62,-5972.28,44.9642,0,0,0,0,0,0,0,0,0,0,3.50074,0,0),(128889,27,2250.32,-5978.05,37.1378,0,0,0,0,0,0,0,0,0,0,3.68923,0,0),
(128889,28,2242.16,-5986.44,32.0029,0,0,0,0,0,0,0,0,0,0,3.9759,0,0),(128889,29,2236.48,-5994.7,27.2984,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),(128889,30,2232.02,-6001.88,21.9415,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),
(128889,31,2222.59,-6018.69,9.85442,0,0,0,0,0,0,0,0,0,0,4.25079,0,0),(128889,32,2210.65,-6043.1,6.58405,0,0,0,0,0,0,0,0,0,0,4.27435,0,0),(128889,33,2195.04,-6068.81,4.8415,0,0,0,0,0,0,0,0,0,0,4.29006,0,0),
(128889,34,2184.79,-6100.61,0.801771,0,0,0,0,0,0,0,0,0,0,4.45499,0,0),(128889,35,2180.3,-6117.91,1.28701,0,0,0,0,0,0,0,0,0,0,4.35368,0,0),(128889,36,2176.49,-6139.76,1.21043,0,0,0,0,0,0,0,0,0,0,4.53432,0,0),
(128889,37,2168.43,-6148.86,1.24682,0,0,0,0,0,0,0,0,0,0,3.76777,0,0),(128889,38,2151.16,-6153.96,1.24645,0,0,0,0,0,0,0,0,0,0,3.43005,0,0),(128889,39,2134,-6167.23,0.364198,0,0,0,0,0,0,0,0,0,0,4.12905,0,0),
(128889,40,2122.69,-6185.79,14.1288,0,0,0,0,0,0,0,0,0,0,4.1801,0,0),(128889,41,2119.26,-6191.63,13.2701,2000,2882202,0,0,0,0,0,0,0,0,4.1801,0,0);
-- Scarlet Miner & Mine car #9
UPDATE creature SET position_x = 2453.786133, position_y = -5953.487793, position_z = 95.258797, orientation = 4.55 WHERE guid = 128870;
UPDATE creature SET position_x = 2453.786133, position_y = -5953.487793, position_z = 95.258797, orientation = 4.55, MovementType = 2, spawndist = 0 WHERE guid = 128895;
DELETE FROM creature_movement WHERE id = 128895;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128895,1,2453.786133,-5953.487793,95.258797,2000,2882201,0,0,0,0,0,0,0,0,4.55,0,0),(128895,2,2452.72,-5967.06,94.948,0,0,0,0,0,0,0,0,0,0,3.58,0,0),(128895,3,2437.21,-5970.83,95.8699,0,0,0,0,0,0,0,0,0,0,2.94,0,0),
(128895,4,2423.33,-5964.13,96.3004,0,0,0,0,0,0,0,0,0,0,2.34035,0,0),(128895,5,2418.46,-5954.75,98.1128,0,0,0,0,0,0,0,0,0,0,1.57615,0,0),(128895,6,2421.02,-5945.06,96.5866,0,0,0,0,0,0,0,0,0,0,0.982392,0,0),
(128895,7,2424.15,-5940.43,95.9135,0,0,0,0,0,0,0,0,0,0,0.759339,0,0),(128895,8,2438.46,-5930.17,96.4525,0,0,0,0,0,0,0,0,0,0,0.831971,0,0),(128895,9,2443.21,-5922.16,99.5292,0,0,0,0,0,0,0,0,0,0,1.45604,0,0),
(128895,10,2442.92,-5913.71,102.054,0,0,0,0,0,0,0,0,0,0,1.88668,0,0),(128895,11,2440.51,-5904.33,103.104,0,0,0,0,0,0,0,0,0,0,1.76965,0,0),(128895,12,2435.25,-5889.95,104.966,0,0,0,0,0,0,0,0,0,0,2.12387,0,0),
(128895,13,2431.46,-5885.3,104.595,0,0,0,0,0,0,0,0,0,0,2.69687,0,0),(128895,14,2424.06,-5886.49,104.586,0,0,0,0,0,0,0,0,0,0,3.56276,0,0),(128895,15,2416.01,-5891.31,104.585,2000,2882202,0,0,0,0,0,0,0,0,3.657,0,0);
-- Scarlet Miner & Mine car #10
UPDATE creature SET position_x = 2538.022949, position_y = -5995.528809, position_z = 103.005615, orientation = 2.9 WHERE guid = 128876;
UPDATE creature SET position_x = 2538.022949, position_y = -5995.528809, position_z = 103.005615, orientation = 2.9, MovementType = 2, spawndist = 0 WHERE guid = 128901;
DELETE FROM creature_movement WHERE id = 128901;
INSERT INTO creature_movement (id, point, position_x, position_y, position_z, waittime, script_id, textid1, textid2, textid3, textid4, textid5, emote, spell, wpguid, orientation, model1, model2) VALUES
(128901,1,2538.022949,-5995.528809,103.005615,2000,2882201,0,0,0,0,0,0,0,0,2.9,0,0),(128901,2,2531.93,-5989.03,102.994,0,0,0,0,0,0,0,0,0,0,2.24,0,0),(128901,3,2523.14,-5974.86,104.929,0,0,0,0,0,0,0,0,0,0,1.94,0,0),
(128901,4,2520.59,-5965.89,105.946,0,0,0,0,0,0,0,0,0,0,1.59666,0,0),(128901,5,2521.93,-5958.41,107.339,0,0,0,0,0,0,0,0,0,0,1.40423,0,0),(128901,6,2522.63,-5951.68,109.591,0,0,0,0,0,0,0,0,0,0,1.71447,0,0),
(128901,7,2518.94,-5943.86,110.237,0,0,0,0,0,0,0,0,0,0,2.42133,0,0),(128901,8,2509.7,-5935.12,113.338,0,0,0,0,0,0,0,0,0,0,2.58704,0,0),(128901,9,2504.82,-5932.35,115.145,0,0,0,0,0,0,0,0,0,0,2.85644,0,0),
(128901,10,2494.22,-5933.43,115.605,0,0,0,0,0,0,0,0,0,0,3.53504,0,0),(128901,11,2488.27,-5937.53,116.217,0,0,0,0,0,0,0,0,0,0,3.72668,0,0),(128901,12,2481.15,-5940.7,115.362,0,0,0,0,0,0,0,0,0,0,2.90044,0,0),
(128901,13,2473.54,-5938.41,115.133,0,0,0,0,0,0,0,0,0,0,2.57702,0,0),(128901,14,2469.97,-5932.41,115.97,0,0,0,0,0,0,0,0,0,0,1.90066,0,0),(128901,15,2469.85,-5932.18,115.978,0,0,0,0,0,0,0,0,0,0,1.88931,0,0),
(128901,16,2465.38,-5916.21,113.31,0,0,0,0,0,0,0,0,0,0,2.5514,0,0),(128901,17,2453.98,-5909.97,112.809,0,0,0,0,0,0,0,0,0,0,3.11693,0,0),(128901,18,2437,-5915.94,112.788,0,0,0,0,0,0,0,0,0,0,3.14599,0,0),
(128901,19,2428.36,-5912.56,112.956,0,0,0,0,0,0,0,0,0,0,3.47665,0,0),(128901,20,2419.72,-5916.33,111.72,0,0,0,0,0,0,0,0,0,0,3.57089,0,0),(128901,21,2407.87,-5920.25,110.704,0,0,0,0,0,0,0,0,0,0,3.09023,0,0),
(128901,22,2382.72,-5912.66,109.618,0,0,0,0,0,0,0,0,0,0,2.8012,0,0),(128901,23,2360.63,-5906.09,105.863,0,0,0,0,0,0,0,0,0,0,2.87974,0,0),(128901,24,2339.74,-5900.61,102.166,0,0,0,0,0,0,0,0,0,0,3.0164,0,0),
(128901,25,2320.65,-5901.12,96.3481,0,0,0,0,0,0,0,0,0,0,3.36748,0,0),(128901,26,2302.29,-5906.91,88.4851,0,0,0,0,0,0,0,0,0,0,3.71462,0,0),(128901,27,2298.87,-5912.52,85.7672,0,0,0,0,0,0,0,0,0,0,4.15602,0,0),
(128901,28,2294.47,-5920.02,80.6317,0,0,0,0,0,0,0,0,0,0,4.48588,0,0),(128901,29,2295.5,-5927.8,75.0694,0,0,0,0,0,0,0,0,0,0,4.50787,0,0),(128901,30,2289.38,-5936.56,68.8048,0,0,0,0,0,0,0,0,0,0,4.35394,0,0),
(128901,31,2281.71,-5954.08,57.7201,0,0,0,0,0,0,0,0,0,0,4.07015,0,0),(128901,32,2273.67,-5964.09,51.0012,0,0,0,0,0,0,0,0,0,0,3.82197,0,0),(128901,33,2263.62,-5972.28,44.9642,0,0,0,0,0,0,0,0,0,0,3.50074,0,0),
(128901,34,2250.32,-5978.05,37.1378,0,0,0,0,0,0,0,0,0,0,3.68923,0,0),(128901,35,2242.16,-5986.44,32.0029,0,0,0,0,0,0,0,0,0,0,3.9759,0,0),(128901,36,2236.48,-5994.7,27.2984,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),
(128901,37,2232.02,-6001.88,21.9415,0,0,0,0,0,0,0,0,0,0,4.15654,0,0),(128901,38,2222.59,-6018.69,9.85442,0,0,0,0,0,0,0,0,0,0,4.25079,0,0),(128901,39,2210.65,-6043.1,6.58405,0,0,0,0,0,0,0,0,0,0,4.27435,0,0),
(128901,40,2195.04,-6068.81,4.8415,0,0,0,0,0,0,0,0,0,0,4.29006,0,0),(128901,41,2184.79,-6100.61,0.801771,0,0,0,0,0,0,0,0,0,0,4.45499,0,0),(128901,42,2180.3,-6117.91,1.28701,0,0,0,0,0,0,0,0,0,0,4.35368,0,0),
(128901,43,2176.49,-6139.76,1.21043,0,0,0,0,0,0,0,0,0,0,4.53432,0,0),(128901,44,2168.43,-6148.86,1.24682,0,0,0,0,0,0,0,0,0,0,3.76777,0,0),(128901,45,2151.16,-6153.96,1.24645,0,0,0,0,0,0,0,0,0,0,3.43005,0,0),
(128901,46,2134,-6167.23,0.364198,0,0,0,0,0,0,0,0,0,0,4.12905,0,0),(128901,47,2122.69,-6185.79,14.1288,0,0,0,0,0,0,0,0,0,0,4.1801,0,0),(128901,48,2119.26,-6191.63,13.2701,2000,2882202,0,0,0,0,0,0,0,0,4.1801,0,0);
-- movement scripts
DELETE FROM dbscripts_on_creature_movement WHERE id IN (2882201,2882202);
INSERT INTO dbscripts_on_creature_movement (id, delay, command, datalong, datalong2, buddy_entry, search_radius, data_flags, dataint, dataint2, dataint3, dataint4, x, y, z, o, comments) VALUES
(2882201,1,21,1,0,0,0,0,0,0,0,0,0,0,0,0,'active'),
(2882202,1,21,0,0,0,0,0,0,0,0,0,0,0,0,0,'unactive'),
(2882202,2,18,0,0,0,0,0,0,0,0,0,0,0,0,0,'despawn'); 
-- Mine Car
DELETE FROM creature_linking WHERE guid IN (128860,128864,128868,128869,128870,128873,128874,128876,128879,128880);
INSERT INTO creature_linking (guid, master_guid, flag) VALUES
(128860, 128885, 16+128+512+8192),(128864, 128889, 16+128+512+8192),(128868, 128893, 16+128+512+8192),(128869, 128894, 16+128+512+8192),(128870, 128895, 16+128+512+8192),
(128873, 128898, 16+128+512+8192),(128874, 128899, 16+128+512+8192),(128876, 128901, 16+128+512+8192),(128879, 128904, 16+128+512+8192),(128880, 128905, 16+128+512+8192);
    

        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        -- -- PLACE UPDATE SQL ABOVE -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -

        -- If we get here ok, commit the changes
        IF bRollback = TRUE THEN
            ROLLBACK;
            SHOW ERRORS;
            SELECT '* UPDATE FAILED *' AS `===== Status =====`,@cCurResult AS `===== DB is on Version: =====`;



        ELSE
            COMMIT;
            SELECT '* UPDATE COMPLETE *' AS `===== Status =====`,@cNewResult AS `===== DB is now on Version =====`;
        END IF;
    ELSE    -- Current version is not the expected version
        IF (@cCurResult = @cNewResult) THEN    -- Does the current version match the new version
            SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cCurResult AS `===== DB is already on Version =====`;
        ELSE    -- Current version is not one related to this update
            IF(@cCurResult IS NULL) THEN    -- Something has gone wrong
                SELECT '* UPDATE FAILED *' AS `===== Status =====`,'Unable to locate DB Version Information' AS `============= Error Message =============`;
            ELSE
		IF(@cOldResult IS NULL) THEN    -- Something has gone wrong
		    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
		    SET @cCurStructure := (SELECT `STRUCTURE` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
		    SET @cCurContent := (SELECT `Content` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurOutput = CONCAT(@cCurVersion, '_', @cCurStructure, '_', @cCurContent, ' - ',@cCurResult);
                    SET @cOldResult = CONCAT('Rel',@cOldVersion, '_', @cOldStructure, '_', @cOldContent, ' - ','IS NOT APPLIED');
                    SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cOldResult AS `=== Expected ===`,@cCurOutput AS `===== Found Version =====`;
		ELSE
		    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
		    SET @cCurStructure := (SELECT `STRUCTURE` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
		    SET @cCurContent := (SELECT `Content` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurOutput = CONCAT(@cCurVersion, '_', @cCurStructure, '_', @cCurContent, ' - ',@cCurResult);
                    SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cOldResult AS `=== Expected ===`,@cCurOutput AS `===== Found Version =====`;
                END IF;
            END IF;
        END IF;
    END IF;
END $$

DELIMITER ;

-- Execute the procedure
CALL update_mangos();

-- Drop the procedure
DROP PROCEDURE IF EXISTS `update_mangos`;

